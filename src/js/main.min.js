var domCache={$window:$(window),$body:$("body"),$videoPopup:null,$wallpaperPopup:null,$termsPopup:null,$imagePopup:null,$mobileMenu:null,$mobileMenuOverlay:null,$menuBtn:null,$closeBtn:null,init:function(){this.$videoPopup=$(".video-popup"),this.$wallpaperPopup=$(".wallpaper-popup"),this.$termsPopup=$(".terms-popup"),this.$imagePopup=$(".image-popup"),this.$mobileMenu=$(".mobile-menu"),this.$mobileMenuOverlay=$(".mobile-menu-overlay"),this.$menuBtn=$(".menu_btn"),this.$closeBtn=$(".mobile-menu .close-btn")}};function debounce(e,t){var n;return function(){var o=this,i=arguments;clearTimeout(n),n=setTimeout(function(){n=null,e.apply(o,i)},t)}}var MarqueeController={tracks:null,originalContent:{},resetInterval:null,isInitialized:!1,init:function(){this.isInitialized||(this.tracks=document.querySelectorAll(".marquee .track"),0!==this.tracks.length&&(this.tracks.forEach(function(e,t){MarqueeController.originalContent[t]=e.innerHTML}),this.isInitialized=!0))},start:function(){this.isInitialized||this.init(),0!==this.tracks.length&&(this.resetInterval&&clearInterval(this.resetInterval),this.resetAnimation(),this.resetInterval=setInterval(function(){MarqueeController.resetAnimation()},3e4))},resetAnimation:function(){var e=this;this.tracks.forEach(function(t,n){t.style.animation="none",t.innerHTML=e.originalContent[n],t.innerHTML+=e.originalContent[n],t.offsetHeight,t.style.animation=null})},stop:function(){this.resetInterval&&(clearInterval(this.resetInterval),this.resetInterval=null)}};function openModal(e){domCache.$videoPopup.filter(":visible").hide().attr("aria-hidden","true"),domCache.$wallpaperPopup.filter(":visible").hide().attr("aria-hidden","true"),domCache.$termsPopup.filter(":visible").hide().attr("aria-hidden","true"),domCache.$imagePopup.filter(":visible").hide().attr("aria-hidden","true");var t=domCache.$window.scrollTop();domCache.$body.data("scroll-position",t),domCache.$body.addClass("modal-open").css("top",-t+"px"),domCache.$window.off("scroll.menuFix"),e.css("display","flex").attr("aria-hidden","false");var n=e.find(".close-btn").first();n.length&&n.trigger("focus")}function closeModal(e){e.css("display","none").attr("aria-hidden","true");var t=domCache.$body.data("scroll-position")||0;domCache.$body.removeClass("modal-open").css("top",""),domCache.$window.scrollTop(t),setTimeout(function(){initMenuFixScroll()},50)}function getMarqueeHeight(){var e=$(".marquee");return e.length?e.outerHeight():window.innerWidth<=576?40:window.innerWidth<=1024?50:60}function getMenuFixPosition(){return getMarqueeHeight()}function getHideTransform(){return"translateY(-"+($(".menu_fix").outerHeight()||70)+"px)"}function initMenuFixScroll(){domCache.$window.on("scroll.menuFix",debounce(function(){var e=$(".menu"),t=$(".menu_fix");if(e.length&&t.length){var n=e.offset().top+e.outerHeight(),o=domCache.$window.scrollTop(),i=getMarqueeHeight();o>n?t.css({top:i+"px",transform:"translateY(0)","box-shadow":"0 7px 0px rgba(0, 0, 0, 0.1)"}):t.css({top:"0px",transform:getHideTransform(),"box-shadow":"none"})}},16))}document.addEventListener("DOMContentLoaded",function(){MarqueeController.init()}),document.addEventListener("visibilitychange",function(){!document.hidden&&MarqueeController.isInitialized&&MarqueeController.start()}),$(function(){domCache.init();var e=domCache.$videoPopup;$("#playbtn").on("click",function(t){t.preventDefault(),openModal(e)}),$(".video-popup .close-btn").on("click",function(){var t=e.find("iframe");t.attr("src",t.attr("src")),closeModal(e)}),e.on("click",function(t){if(t.target===this){var n=e.find("iframe");n.attr("src",n.attr("src")),closeModal(e)}})}),$(function(){var e=$(".theme .wallpaper-popup");$(".theme .download .btn").on("click keydown",function(t){"click"!==t.type&&("keydown"!==t.type||"Enter"!==t.key&&" "!==t.key)||(t.preventDefault(),$(document).data("lastTrigger",this),e.parent().hasClass("theme")&&(e.data("original-parent",e.parent()),e.appendTo("body")),openModal(e))}),$(".theme .wallpaper-popup .close-btn").on("click",function(){closeModal(e);var t=e.data("original-parent");t&&t.length&&e.appendTo(t);var n=$(document).data("lastTrigger");n&&$(n).focus()}),e.on("click",function(t){if(t.target===this){closeModal(e);var n=e.data("original-parent");n&&n.length&&e.appendTo(n);var o=$(document).data("lastTrigger");o&&$(o).focus()}}),$(document).on("keydown",function(t){if("Escape"===t.key){var n=$(".video-popup");if(n.is(":visible")){var o=n.find("iframe");return o.attr("src",o.attr("src")),void closeModal(n)}if(e.is(":visible")){closeModal(e);var i=e.data("original-parent");i&&i.length&&e.appendTo(i);var a=$(document).data("lastTrigger");a&&$(a).focus()}}})}),$(function(){var e=$(".terms-popup");$(document).on("click keydown",'a[data-popup="terms"], .open-terms, .terms-btn',function(t){"click"!==t.type&&("keydown"!==t.type||"Enter"!==t.key&&" "!==t.key)||(t.preventDefault(),$(document).data("lastTrigger",this),openModal(e))}),$(document).on("click",".terms-popup .close-btn",function(){closeModal(e);var t=$(document).data("lastTrigger");t&&$(t).focus()}),e.on("click",function(t){if(t.target===this){closeModal(e);var n=$(document).data("lastTrigger");n&&$(n).focus()}}),$(document).on("keydown",function(t){if("Escape"===t.key&&e.is(":visible")){closeModal(e);var n=$(document).data("lastTrigger");n&&$(n).focus()}})}),$(function(){var e=$(".image-popup");$(document).on("click",".weartocare .card img[data-large], .carousel-slide img[data-large]",function(t){t.preventDefault(),t.stopPropagation();var n=$(this),o=n.attr("data-large")||n.attr("src"),i=n.attr("alt")||"圖片預覽";e.find(".preview img").attr("src",o).attr("alt",i),$(document).data("lastTrigger",this),openModal(e)}),$(".image-popup .close-btn").on("click",function(){closeModal(e);var t=$(document).data("lastTrigger");t&&$(t).focus()}),e.on("click",function(t){if(t.target===this){closeModal(e);var n=$(document).data("lastTrigger");n&&$(n).focus()}}),$(document).on("keydown",function(t){if("Escape"===t.key&&e.is(":visible")){closeModal(e);var n=$(document).data("lastTrigger");n&&$(n).focus()}})}),$(function(){var e=$(".menu"),t=$(".menu_fix");$(".marquee");e.length&&t.length&&(t.css({top:"0px",transform:getHideTransform(),transition:"transform 0.3s ease-in-out, top 0.3s ease-in-out","box-shadow":"none"}),initMenuFixScroll(),domCache.$window.on("resize",debounce(function(){if(domCache.$window.scrollTop()>e.offset().top+e.outerHeight()){var n=getMarqueeHeight();t.css({top:n+"px",transform:"translateY(0)"})}else t.css({top:"0px",transform:getHideTransform()})},250)))}),$(function(){var e=domCache.$menuBtn,t=domCache.$mobileMenu,n=domCache.$mobileMenuOverlay,o=domCache.$closeBtn;function i(){t.removeClass("active"),n.removeClass("active")}e.on("click",function(e){e.preventDefault(),t.addClass("active"),n.addClass("active")}),o.on("click",function(e){e.preventDefault(),i()}),n.on("click",function(e){e.target===this&&i()}),$(".mobile-menu-item").on("click",function(){i()}),$(document).on("keydown",function(e){"Escape"===e.key&&t.hasClass("active")&&i()}),domCache.$window.on("resize",debounce(function(){window.innerWidth>1024&&t.hasClass("active")&&i()},250))}),$(document).ready(function(){$("body").addClass("loading-lock"),window.scrollTo(0,0),$(".theme").css({display:"flex",visibility:"visible"}),$(".theme .wallpaper-popup, .theme .popup").hide(),console.log("Theme section preloaded and made visible during page load")}),domCache.$window.on("load",function(){setTimeout(function(){$(".loading-screen").addClass("slide-up"),setTimeout(function(){$(".loading-screen").remove(),$("body").removeClass("loading-lock"),void 0!==MarqueeController&&MarqueeController.start(),setTimeout(function(){$(".fade_fv").addClass("fade-in")},300),setTimeout(function(){$(".fade_sticker").addClass("fade-in")},500)},400)},1e3)}),$(function(){$('a[href="#download"], a.download').on("click",function(e){e.preventDefault(),$("html, body").stop(!0,!0),setTimeout(function(){var e=$("#download");e.length?(document.body.offsetHeight,e[0].offsetHeight,$(window).trigger("resize"),setTimeout(function(){var t=e.offset().top-100;console.log("Using offset:",100),console.log("Target position calculated:",t),console.log("Current scroll position:",$(window).scrollTop()),$("html, body").animate({scrollTop:t},{duration:600,easing:"swing",complete:function(){console.log("Scroll completed at position:",$(window).scrollTop()),setTimeout(function(){var t=e.offset().top-100,n=$(window).scrollTop();Math.abs(n-t)>10&&(console.log("Position correction needed, adjusting..."),window.scrollTo(0,t))},100)}})},50)):console.log("Target element not found!")},100)})}),$(function(){$(".carousel-container").each(function(){var e,t=$(this),n=t.find(".carousel-track"),o=t.find(".carousel-slide"),i=t.find(".dot"),a=o.length,r=1,s=!1,l={startX:0,startY:0,currentX:0,currentY:0,isDragging:!1,isVerticalScroll:!1,startTime:0,moved:!1};if(!(a<=1)){var c=n[0];c.addEventListener("touchstart",m,{passive:!1}),c.addEventListener("touchmove",v,{passive:!1}),c.addEventListener("touchend",h,{passive:!1}),c.addEventListener("touchcancel",h,{passive:!1}),"ontouchstart"in window||(n.on("mousedown",function(e){m(e)}),$(document).on("mousemove",function(e){l.isDragging&&v(e)}),$(document).on("mouseup",function(e){l.isDragging&&h()})),n.on("click",function(e){l.moved&&(e.preventDefault(),e.stopPropagation())}),i.on("click",function(){!function(e){s||(r=e+1,u())}($(this).data("slide")),clearInterval(e),g()}),t.find(".carousel-prev").on("click",function(t){t.preventDefault(),t.stopPropagation(),p(),clearInterval(e),g()}),t.find(".carousel-next").on("click",function(t){t.preventDefault(),t.stopPropagation(),f(),clearInterval(e),g()}),t.on("mouseenter",function(){clearInterval(e)}),t.on("mouseleave",function(){l.isDragging||g()}),function(){var e=o.last().clone();n.prepend(e);var t=o.first().clone();n.append(t),n.css({transform:"translateX(-100%)",transition:"none"})}(),u(),g()}function u(e){var t=100*-r;e?n.css({transform:"translateX("+t+"%)",transition:"none"}):n.css({transform:"translateX("+t+"%)",transition:"transform 0.3s cubic-bezier(0.4, 0.0, 0.2, 1)"});var o=((r-1)%a+a)%a;i.removeClass("active"),i.eq(o).addClass("active")}function d(){s||(r>=a+1?(s=!0,setTimeout(function(){r=1,u(!0),s=!1},300)):r<=0&&(s=!0,setTimeout(function(){r=a,u(!0),s=!1},300)))}function f(){s||(r++,u(),d())}function p(){s||(r--,u(),d())}function m(t){if(!s){var o=t.touches?t.touches[0]:t;l.startX=o.clientX,l.startY=o.clientY,l.currentX=o.clientX,l.currentY=o.clientY,l.isDragging=!0,l.isVerticalScroll=!1,l.startTime=Date.now(),l.moved=!1,clearInterval(e),n.css("transition","none")}}function v(e){if(l.isDragging&&!s){var o=e.touches?e.touches[0]:e;l.currentX=o.clientX,l.currentY=o.clientY;var i=l.currentX-l.startX,a=l.currentY-l.startY,c=Math.abs(i),u=Math.abs(a);if(!l.moved&&(c>5||u>5)&&(l.moved=!0,u>1.5*c&&(l.isVerticalScroll=!0)),!l.isVerticalScroll&&l.moved){e.preventDefault();var d=i/t.width()*100,f=100*-r+d;n.css("transform","translateX("+f+"%)")}}}function h(e){if(l.isDragging){if(l.isDragging=!1,l.isVerticalScroll)return u(),void g();var n=l.currentX-l.startX,o=Date.now()-l.startTime,i=Math.abs(n)/o,a=.15*t.width();(Math.abs(n)>a||i>.3)&&l.moved?n>0?p():f():u(),g()}}function g(){clearInterval(e),e=setInterval(f,4e3)}})}),document.addEventListener("DOMContentLoaded",function(){const e=new IntersectionObserver(function(e){e.forEach(function(e){e.isIntersecting&&e.target.classList.add("fade-in")})},{threshold:.2,rootMargin:"0px 0px -50px 0px"});function t(){document.querySelectorAll(".fade, .fade-fast, .fade-slow, .fade_text, .fade_text-fast, .fade_text-slow").forEach(function(t){t.classList.contains("fade-in")||e.observe(t)})}t(),window.refreshFadeAnimation=function(){t()}}),setTimeout(function(){void 0!==MarqueeController&&(document.querySelector(".loading-screen")?setTimeout(function(){MarqueeController.start()},2e3):MarqueeController.start())},3e3),/Mobi|Android/i.test(navigator.userAgent)&&(window.addEventListener("focus",function(){setTimeout(function(){void 0!==MarqueeController&&MarqueeController.isInitialized&&MarqueeController.start()},500)}),document.addEventListener("touchstart",function(){setTimeout(function(){if(void 0!==MarqueeController&&MarqueeController.isInitialized){var e=document.querySelectorAll(".marquee .track"),t=!1;e.forEach(function(e){e.style.animation&&"none"!==e.style.animation&&(t=!0)}),t||MarqueeController.start()}},1e3)},{once:!0}));